import fs from 'node:fs/promises'
import { describe, it, expect } from 'vitest'
import { parseGitMergeOutput } from '@src/index'

describe('git-adapter', () => {
  describe('parseGitMergeOutput', () => {
    it('should extract added files from merge output', async () => {
      // Given
      const mergeOutput = await fs.readFile(__dirname + '/git_merge.out', 'utf8')

      // When
      const files = parseGitMergeOutput(mergeOutput)

      // Then
      expect(files).toEqual([
        'services/leasing/.env.ci',
        'services/leasing/.env.template',
        'services/leasing/.env.test.template',
        'services/leasing/.github/dependabot.yml',
        'services/leasing/.github/workflows/ci.yml',
        'services/leasing/.github/workflows/lint-and-test.yml',
        'services/leasing/.github/workflows/production.yml',
        'services/leasing/.gitignore',
        'services/leasing/.jest/common.ts',
        'services/leasing/.jest/migrate.ts',
        'services/leasing/.jest/teardown.ts',
        'services/leasing/.nvmrc',
        'services/leasing/.prettierrc',
        'services/leasing/.vim/coc-settings.json',
        'services/leasing/.vscode/extensions.json',
        'services/leasing/.vscode/settings.json',
        'services/leasing/Dockerfile',
        'services/leasing/README.md',
        'services/leasing/docker-compose.yaml',
        'services/leasing/eslint.config.mjs',
        'services/leasing/jest.config.js',
        'services/leasing/knexfile.js',
        'services/leasing/migrations/20230608155044_lease-table.js',
        'services/leasing/migrations/20230616135116_contact-table.js',
        'services/leasing/migrations/20240313135000_create_listing_table.js',
        'services/leasing/migrations/20240313135024_create_applicant_table.js',
        'services/leasing/migrations/20240429140706_add-index-applicant-listing-id.js',
        'services/leasing/migrations/20240506123342_add_national_registration_number_to_applicant.js',
        'services/leasing/migrations/20240513163957_create-offer-table.js',
        'services/leasing/migrations/20240517140551_unique-offer-applicant-listing.js',
        'services/leasing/migrations/20240521130555_add-offer-created-at.js',
        'services/leasing/migrations/20240603124731_increase-offer-selection-snapshot-size.js',
        'services/leasing/migrations/20240904064648_add-listing-constraint.js',
        'services/leasing/migrations/20240923123213_update-offer-status-type.js',
        'services/leasing/migrations/20240928143018_create-offer-applicant.js',
        'services/leasing/migrations/20241029104159_unique-listing-non-closed.js',
        'services/leasing/migrations/20241104133517_create-application-profile.js',
        'services/leasing/migrations/20241107153227_make-applicant-priority-nullable-in-offer-applicant.js',
        'services/leasing/migrations/20241112125047_unique-listing-non-closed-assigned.js',
        'services/leasing/migrations/20241202125044_extend-application-profile.js',
        'services/leasing/migrations/20241216104418_refactor-housing-reference.js',
        'services/leasing/migrations/20250121103952_application-profile-housing-reference-expires_at-nullable.js',
        'services/leasing/migrations/20250218133907_revise-application-profile.js',
        'services/leasing/migrations/20250325075550_make-name-and-nationalRegistrationNumber-nullable-for-applicant.js',
        'services/leasing/migrations/20250523145209_create-comments-table.js',
        'services/leasing/migrations/20250618075727_update-listing-table.js',
        'services/leasing/package-lock.json',
        'services/leasing/package.json',
        'services/leasing/seeds/dev/tenants-and-leases.js',
        'services/leasing/src/api.ts',
        'services/leasing/src/app.ts',
        'services/leasing/src/common/config.ts',
        'services/leasing/src/common/test/matchers.ts',
        'services/leasing/src/common/types.ts',
        'services/leasing/src/constants/leaseTypes.ts',
        'services/leasing/src/helpers/personnummer.ts',
        'services/leasing/src/index.ts',
        'services/leasing/src/middlewares/error-handler.test.ts',
        'services/leasing/src/middlewares/error-handler.ts',
        'services/leasing/src/middlewares/parse-request-body.ts',
        'services/leasing/src/scripts/expire-listings.ts',
        'services/leasing/src/services/creditsafe/adapters/creditsafe-adapter.ts',
        'services/leasing/src/services/creditsafe/index.ts',
        'services/leasing/src/services/creditsafe/tests/index.test.ts',
        'services/leasing/src/services/health-service/index.ts',
        'services/leasing/src/services/lease-service/adapters/application-profile-adapter.ts',
        'services/leasing/src/services/lease-service/adapters/comment-adapter.ts',
        'services/leasing/src/services/lease-service/adapters/db-schemas.ts',
        'services/leasing/src/services/lease-service/adapters/db.ts',
        'services/leasing/src/services/lease-service/adapters/listing-adapter.ts',
        'services/leasing/src/services/lease-service/adapters/offer-adapter.ts',
        'services/leasing/src/services/lease-service/adapters/types.ts',
        'services/leasing/src/services/lease-service/adapters/utils.ts',
        'services/leasing/src/services/lease-service/adapters/xpand/estate-code-adapter.ts',
        'services/leasing/src/services/lease-service/adapters/xpand/invoices-adapter.ts',
        'services/leasing/src/services/lease-service/adapters/xpand/rental-object-adapter.ts',
        'services/leasing/src/services/lease-service/adapters/xpand/tenant-lease-adapter.ts',
        'services/leasing/src/services/lease-service/adapters/xpand/xpand-soap-adapter.ts',
        'services/leasing/src/services/lease-service/adapters/xpand/xpandDb.ts',
        'services/leasing/src/services/lease-service/create-or-update-application-profile.ts',
        'services/leasing/src/services/lease-service/get-tenant.ts',
        'services/leasing/src/services/lease-service/helpers/transformFromXPandDb.ts',
        'services/leasing/src/services/lease-service/index.ts',
        'services/leasing/src/services/lease-service/offer-service.ts',
        'services/leasing/src/services/lease-service/priority-list-service.ts',
        'services/leasing/src/services/lease-service/property-rental-rules-validator.ts',
        'services/leasing/src/services/lease-service/residential-area-rental-rules-validator.ts',
        'services/leasing/src/services/lease-service/routes/applicants.ts',
        'services/leasing/src/services/lease-service/routes/comments.ts',
        'services/leasing/src/services/lease-service/routes/contacts.ts',
        'services/leasing/src/services/lease-service/routes/invoices.ts',
        'services/leasing/src/services/lease-service/routes/leases.ts',
        'services/leasing/src/services/lease-service/routes/listings.ts',
        'services/leasing/src/services/lease-service/routes/offers.ts',
        'services/leasing/src/services/lease-service/routes/rental-objects.ts',
        'services/leasing/src/services/lease-service/sync-internal-parking-space-listings-from-xpand.ts',
        'services/leasing/src/services/lease-service/tests/adapters/application-profile-adapter.test.ts',
        'services/leasing/src/services/lease-service/tests/adapters/listing-adapter/delete-listing.test.ts',
        'services/leasing/src/services/lease-service/tests/adapters/listing-adapter/get-listings-with-applicants.test.ts',
        'services/leasing/src/services/lease-service/tests/adapters/listing-adapter/get-listings.test.ts',
        'services/leasing/src/services/lease-service/tests/adapters/listing-adapter/index.test.ts',
        'services/leasing/src/services/lease-service/tests/adapters/offer-adapter.test.ts',
        'services/leasing/src/services/lease-service/tests/adapters/xpand/invoices-adapter.test.ts',
        'services/leasing/src/services/lease-service/tests/adapters/xpand/tenant-lease-adapter.test.ts',
        'services/leasing/src/services/lease-service/tests/create-or-update-application-profile.test.ts',
        'services/leasing/src/services/lease-service/tests/factories/applicant.ts',
        'services/leasing/src/services/lease-service/tests/factories/application-profile.ts',
        'services/leasing/src/services/lease-service/tests/factories/contact.ts',
        'services/leasing/src/services/lease-service/tests/factories/detailed-applicant.ts',
        'services/leasing/src/services/lease-service/tests/factories/index.ts',
        'services/leasing/src/services/lease-service/tests/factories/invoice.ts',
        'services/leasing/src/services/lease-service/tests/factories/lease.ts',
        'services/leasing/src/services/lease-service/tests/factories/listing-without-rental-object.ts',
        'services/leasing/src/services/lease-service/tests/factories/listing.ts',
        'services/leasing/src/services/lease-service/tests/factories/offer-applicant.ts',
        'services/leasing/src/services/lease-service/tests/factories/offer.ts',
        'services/leasing/src/services/lease-service/tests/factories/rental-object.ts',
        'services/leasing/src/services/lease-service/tests/factories/soap-parking-space.ts',
        'services/leasing/src/services/lease-service/tests/factories/tenant.ts',
        'services/leasing/src/services/lease-service/tests/getTenant.test.ts',
        'services/leasing/src/services/lease-service/tests/helpers/transformFromXPandDb.test.ts',
        'services/leasing/src/services/lease-service/tests/index.test.ts',
        'services/leasing/src/services/lease-service/tests/offer-service.test.ts',
        'services/leasing/src/services/lease-service/tests/priority-list-service.test.ts',
        'services/leasing/src/services/lease-service/tests/property-rental-rules-validator.test.ts',
        'services/leasing/src/services/lease-service/tests/residential-area-rental-rules-validator.test.ts',
        'services/leasing/src/services/lease-service/tests/routes/applicants.test.ts',
        'services/leasing/src/services/lease-service/tests/routes/contacts.test.ts',
        'services/leasing/src/services/lease-service/tests/routes/invoices.test.ts',
        'services/leasing/src/services/lease-service/tests/routes/listings.test.ts',
        'services/leasing/src/services/lease-service/tests/routes/offers.test.ts',
        'services/leasing/src/services/lease-service/tests/routes/rentalObjects.test.ts',
        'services/leasing/src/services/lease-service/tests/sync-internal-parking-space-listings-from-xpand.test.ts',
        'services/leasing/src/services/lease-service/tests/testUtils.ts',
        'services/leasing/src/services/lease-service/tests/waiting-list.test.ts',
        'services/leasing/src/services/swagger/index.ts',
        'services/leasing/src/swagger.ts',
        'services/leasing/tsconfig.json',
        'services/leasing/xpand-sync/.env.template',
        'services/leasing/xpand-sync/.nvmrc',
        'services/leasing/xpand-sync/index.ts',
        'services/leasing/xpand-sync/package-lock.json',
        'services/leasing/xpand-sync/package.json',
        'services/leasing/xpand-sync/tsconfig.json',
        'services/leasing/xpand-sync/types.ts',
      ])
    })
  })
})
